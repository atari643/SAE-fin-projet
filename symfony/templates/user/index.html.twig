{% extends './utils/paging.html.twig' %}

{% block title %}Users{% endblock %}

{% block body %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/style.css" />

    <h1>Users List</h1>

    <table style="-moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;">
        <thead>
            <tr>
                <td></td>
                <td>Email</td>
                <td>Creation Date</td>
                <td>Impersonate User</td>
                <td>Role</td>
            </tr>
        </thead>
        {% for user in users %}
        <tbody>
            <tr class="user">
            <td><img src="https://ui-avatars.com/api/?name={{ user.name }}&background=random&rounded=true" style="display: inline;"></td>
            <td><p style="display: inline;">{{ user.name }}</p></td>
            <td><p style="display: inline;">{{ user.registerDate|date('Y-m-d') }}</p></td>
            <td><a href="http://localhost:8000/?page=1&_switch_user={{user.name}}">
            Impersonate</a>
            </button></form></td>
            <td>
                <select name="role" id="role" autocomplete="off" onchange="onSelectChange(this)" disabled>
                    {% if user.admin == '0' %}
                        <option value="{{ 0 ~ ' ' ~ user.id }}" selected>User</option>
                        <option value="{{ 1 ~ ' ' ~ user.id }}">Admin</option>
                        <option value="{{ 2 ~ ' ' ~ user.id }}" disabled="disabled">SuperAdmin</option>
                    {% elseif user.admin == '1' %}
                        <option value="{{ 0 ~ ' ' ~ user.id }}">User</option>
                        <option value="{{ 1 ~ ' ' ~ user.id }}" selected>Admin</option>
                        <option value="{{ 2 ~ ' ' ~ user.id }}" disabled="disabled">SuperAdmin</option>
                    {% elseif user.admin == '2' %}
                        <option value="{{ 0 ~ ' ' ~ user.id }}" disabled="disabled">User</option>
                        <option value="{{ 1 ~ ' ' ~ user.id }}" disabled="disabled">Admin</option>
                        <option value="{{ 2 ~ ' ' ~ user.id }}" disabled="disabled" selected>SuperAdmin</option>
                    {% endif %}
                </select>
            </td>
            </tr>
        </tbody>
    {% endfor %}
    </table>

    {{ block('paging') }}

    <script>
        function onSelectChange(element){
            var values = element.value.split(" ");
            var form = $('<form action="#" method="post">' +
            '<input type="text" name="role" value="' + values[0] + '" hidden />' +
            '<input type="text" name="id" value="' + values[1] + '" hidden />' +
            '</form>');
            $('body').append(form);
            form.submit();#
        }
    </script>
{% endblock %}
