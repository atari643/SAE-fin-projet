{% extends 'base.html.twig' %}

{% block title %}Hello UserController!{% endblock %}

{% block body %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <h1>Liste des utilisateurs</h1>

    <table>
    {% for user in users %}
        <tr class="user">
            <td><img src="https://ui-avatars.com/api/?name={{ user.name }}&background=random&rounded=true" style="display: inline;"></td>
            <td><p style="display: inline;">{{ user.name }}</p></td>
            <td><p style="display: inline;">{{ user.registerDate|date('Y-m-d') }}</p></td>
            <td>
                <select name="role" id="role" autocomplete="off" onchange="onSelectChange(this)">
                    {% if user.admin == '0' %}
                        <option value="{{ 0 ~ ' ' ~ user.id }}" selected>Utilisateur</option>
                        <option value="{{ 1 ~ ' ' ~ user.id }}">Admin</option>
                        <option value="{{ 2 ~ ' ' ~ user.id }}" disabled="disabled">SuperAdmin</option>
                    {% elseif user.admin == '1' %}
                        <option value="{{ 0 ~ ' ' ~ user.id }}">Utilisateur</option>
                        <option value="{{ 1 ~ ' ' ~ user.id }}" selected>Admin</option>
                        <option value="{{ 2 ~ ' ' ~ user.id }}" disabled="disabled">SuperAdmin</option>
                    {% elseif user.admin == '2' %}
                        <option value="{{ 0 ~ ' ' ~ user.id }}" disabled="disabled">Utilisateur</option>
                        <option value="{{ 1 ~ ' ' ~ user.id }}" disabled="disabled">Admin</option>
                        <option value="{{ 2 ~ ' ' ~ user.id }}" disabled="disabled" selected>SuperAdmin</option>
                    {% endif %}
                </select>
            </td>
        </tr>
    {% endfor %}
    </table>

    <script>
        function onSelectChange(element){
            var values = element.value.split(" ");
            var form = $('<form action="#" method="post">' +
            '<input type="text" name="role" value="' + values[0] + '" hidden />' +
            '<input type="text" name="id" value="' + values[1] + '" hidden />' +
            '</form>');
            $('body').append(form);
            form.submit();
        }
    </script>
{% endblock %}
